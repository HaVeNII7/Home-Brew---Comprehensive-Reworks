<!--ROGUE-->

new entry "CInterrupt_SneakAttack"
type "InterruptData"
data "DisplayName" "hd8a8ad84g4f65g46fdgb04dg5b91daf7f291;1"
data "Description" "h23701712ge994g40bfga729g36dc38dc7c65;2"
data "DescriptionParams" "DealDamage(LevelMapValue(SneakAttack),MainMeleeWeaponDamageType)"
data "ExtraDescription" "h76d95144gbf2eg4c33gae0bg9661d52519e1;1"
data "Icon" "Action_SneakAttack_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack())) and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack') or SpellId('Target_Now_You_Dont')) and not AnyEntityIsItem() and not HasStatus('ALERTED',context.Target)"
data "Properties" "IF(IsMeleeAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType);IF(IsMeleeAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandMeleeWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandRangedWeaponDamageType);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(1d4, Force,Magical);ApplyStatus(ALERTED,100,1);IF(HasPassive('Grievous_Wounds', context.Source)):ApplyStatus(GRIEVOUS_WOUNDS,100,1)"
data "Cost" "SneakAttack_Charge:1"
data "Stack" "OnDamage"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "HasActionResource('SneakAttack_Charge',1,0,false,false,context.Source) and (WieldingFinesseWeaponInSpecificHand(context.Source, false) or WieldingFinesseWeaponInSpecificHand(context.Source, true) or WieldingWeapon('Ammunition', false, true, context.Source) or SpellTypeIs(SpellType.Throw))"
data "EnableContext" "OnActionResourcesChanged;OnEquip;OnStatusRemoved;OnStatusApplied"

new entry "CInterrupt_SneakAttack_Magic"
type "InterruptData"
data "DisplayName" "hd8a8ad84g4f65g46fdgb04dg5b91dafss5f8;1"
data "Description" "h23701712ge994g40bfga729g36dc38dss354;2"
data "DescriptionParams" "DealDamage(LevelMapValue(SneakAttack),MainMeleeWeaponDamageType)"
data "ExtraDescription" "h76d95144gbf2eg4c33gae0bg9661d52519e1;1"
data "Icon" "Action_SneakAttack_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack()) or (IsSpell() and HasDamageEffectFlag(DamageFlags.Hit) and TotalDamageDoneGreaterThan(0))) and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack') or SpellId('Target_Now_You_Dont')) and not AnyEntityIsItem() and not HasStatus('ALERTED',context.Target)"
data "Properties" "IF(IsMeleeAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType);IF(IsMeleeAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandMeleeWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandRangedWeaponDamageType);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(1d4, Force,Magical);ApplyStatus(ALERTED,100,1);IF(IsSpell()):DealDamage(LevelMapValue(SneakAttack), Force);IF(HasPassive('Grievous_Wounds', context.Source)):ApplyStatus(GRIEVOUS_WOUNDS,100,1)"
data "Cost" "SneakAttack_Charge:1"
data "Stack" "OnDamage"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "HasActionResource('SneakAttack_Charge',1,0,false,false,context.Source) and (WieldingFinesseWeaponInSpecificHand(context.Source, false) or WieldingFinesseWeaponInSpecificHand(context.Source, true) or WieldingWeapon('Ammunition', false, true, context.Source) or SpellTypeIs(SpellType.Throw))"
data "EnableContext" "OnActionResourcesChanged;OnEquip;OnStatusRemoved;OnStatusApplied"

new entry "Interrupt_Lucky_RollAdditionalDie"
type "InterruptData"
data "DisplayName" "h6bcc3d81g5543g47fcg8f0eg863a3211b2b5;6"
data "Description" "h6336890cg6505g4cd5ga18fg0f06e532eb37;5"
data "Icon" "PassiveFeature_Lucky_RollAdditionalDie"
data "InterruptContext" "OnPostRoll"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "not InterruptHasAdvantage() and (HasInterruptedAttack() and Self(context.Observer,context.Source) and IsRerollInterruptInteresting(context.Source)) or (HasInterruptedSavingThrow() and Self(context.Observer,context.Target) and IsRerollInterruptInteresting()) and not AnyEntityIsItem()"
data "Properties" "SetAdvantage()"
data "Cost" "LuckPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableContext" "OnStatusApplied;OnStatusRemoved"
data "Stack" "OnAbilityCheck"

new entry "Interrupt_Lucky_ReplaceAttackersDie"
type "InterruptData"
data "DisplayName" "h157158c8g7db4g4b27g985bg03ff178a3baa;4"
data "Description" "h28166fbcgedbeg4211ga862g22d330cade06;4"
data "Icon" "PassiveFeature_Lucky_ReplaceAttackersDie"
data "InterruptContext" "OnPostRoll"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and Self(context.Target,context.Observer) and HasInterruptedAttack() and not AnyEntityIsItem() and IsRerollInterruptInteresting(context.Source) and not InterruptHasDisadvantage()"
data "Properties" "SetDisadvantage();ApplyStatus(OBSERVER_TARGET,PASSIVE_WARDING_FLARE,100,0)"
data "Cost" "ReactionActionPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "Stack" "OnEnemySave"

new entry "Interrupt_UncannyDodge"
type "InterruptData"
data "DisplayName" "hc4558204g2c77g4b58gafb6g0ba6b396a366;1"
data "Description" "h098941ccgc4ecg49f2gb22agabed0b03a219;1"
data "Icon" "PassiveFeature_UncannyDodge"
data "InterruptContext" "OnPostRoll"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and not Dead(context.Observer) and HasInterruptedAttack() and Self(context.Observer,context.Target) and not AnyEntityIsItem() and IsRerollInterruptInteresting(context.Source) and IsAttack() and not IsCritical()"
data "Properties" "SetRoll(1)"
data "Cost" "ReactionActionPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "not HasStatus('SG_Blinded')"
data "EnableContext" "OnStatusRemoved;OnStatusApplied"
data "Stack" "SelfAboutBeHit"

<!--MERCENARY-->

new entry "CInterrupt_SneakAttack_Rakish"
type "InterruptData"
using "CInterrupt_SneakAttack"
data "DisplayName" "h34233a5agb50eg4820g9f10g3e21aa0000z1;1"
data "Description" "hba8f1eeeg12c1g43dag9a43g15d42b3000za;3"
data "Icon" "Action_SneakAttack_Melee"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack())) and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5) or (not HasEnemyWithinRange('SG_Incapacitated',1.5, nil, 2,context.Source,context.Target) and not HasAllyWithinRange('SG_Incapacitated',1.5, nil,false,context.Source,context.Target))) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack') or SpellId('Target_Now_You_Dont')) and not AnyEntityIsItem() and not HasStatus('ALERTED',context.Target)"
data "Properties" "IF(IsMeleeAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType);IF(IsMeleeAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandMeleeWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandRangedWeaponDamageType);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(1d4, Force,Magical);ApplyStatus(ALERTED,100,1);IF(HasPassive('Grievous_Wounds', context.Source)):ApplyStatus(GRIEVOUS_WOUNDS,100,1)"

<!--THIEF-->

new entry "Interrupt_LuckyDrawEnemy"
type "InterruptData"
data "DisplayName" "hc4558204g2c77g4b58g6a98522a6b36d9968;1"
data "Description" "h098941ccgc4ecg49f2g6a45123ed0bfefdf5;1"
data "Icon" "PassiveFeature_Mobile_CounterAttackOfOpportunity"
data "InterruptContext" "OnPostRoll"
data "InterruptFlags" "InterruptWhileInvisible"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and not Dead(context.Observer) and HasInterruptedAttack() and Self(context.Observer,context.Target) and not AnyEntityIsItem() and IsRerollInterruptInteresting(context.Source)"
data "Properties" "SetRoll(2);AdjustRoll(-99)"
data "Cost" "LuckPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "Stack" "SelfAboutBeHit"

new entry "Interrupt_LuckyDrawPlayer"
type "InterruptData"
data "DisplayName" "hc4558204g2c77g4b58g6a98522a6b392d5f6;1"
data "Description" "h098941ccgc4ecg49f2g6a45123ed0b0fe8f4;1"
data "Icon" "PassiveFeature_StalkersFlurry"
data "InterruptContext" "OnPostRoll"
data "InterruptFlags" "InterruptWhileInvisible"
data "InterruptContextScope" "Self"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and not Dead(context.Observer) and HasInterruptedAttack() and Enemy(context.Observer,context.Target) and not AnyEntityIsItem() and IsRerollInterruptInteresting(context.Source)"
data "Properties" "SetRoll(2);AdjustRoll(99)"
data "Cost" "LuckPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "Stack" "OnMiss"

<!--PASSIVES-->

new entry "CInterrupt_SneakAttack"
type "InterruptData"
data "DisplayName" "hd8a8ad84g4f65g46fdgb04dg5b91daf7f291;1"
data "Description" "h23701712ge994g40bfga729g36dc38dc7c65;2"
data "DescriptionParams" "DealDamage(LevelMapValue(SneakAttack),MainMeleeWeaponDamageType)"
data "ExtraDescription" "h76d95144gbf2eg4c33gae0bg9661d52519e1;1"
data "Icon" "Action_SneakAttack_Melee"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "Self(context.Source,context.Observer) and HasDamageEffectFlag(DamageFlags.Hit) and ((WieldingFinesseWeaponInSpecificHand(context.Observer,false) and IsMainHandAttack()) or (WieldingFinesseWeaponInSpecificHand(context.Observer,true) and IsOffHandAttack()) or IsThrowAttackRoll() or (WieldingWeapon('Ammunition', false, true, context.Observer) and IsRangedWeaponAttack())) and not IsKillingBlow() and (HasDamageEffectFlag(DamageFlags.AttackAdvantage) or HasAllyWithinRange('SG_Incapacitated',1.5)) and not HasDamageEffectFlag(DamageFlags.AttackDisadvantage) and not (SpellId('Projectile_SneakAttack') or SpellId('Target_SneakAttack') or SpellId('Target_Now_You_Dont')) and not AnyEntityIsItem() and not HasStatus('ALERTED',context.Target)"
data "Properties" "IF(IsMeleeAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainMeleeWeaponDamageType);IF(IsMeleeAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandMeleeWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and not IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), MainRangedWeaponDamageType);IF(IsRangedAttack() and not IsSpell() and IsOffHandAttack()):DealDamage(LevelMapValue(SneakAttack), OffhandRangedWeaponDamageType);IF(HasPassive('MAG_ForcefulSneakAttack_Passive', context.Source)):DealDamage(1d4, Force,Magical);ApplyStatus(ALERTED,100,1);IF(HasPassive('Grievous_Wounds', context.Source)):ApplyStatus(GRIEVOUS_WOUNDS,100,1)"
data "Cost" "SneakAttack_Charge:1"
data "Stack" "OnDamage"
data "InterruptDefaultValue" "Ask;Enabled"
data "EnableCondition" "HasActionResource('SneakAttack_Charge',1,0,false,false,context.Source) and (WieldingFinesseWeaponInSpecificHand(context.Source, false) or WieldingFinesseWeaponInSpecificHand(context.Source, true) or WieldingWeapon('Ammunition', false, true, context.Source) or SpellTypeIs(SpellType.Throw))"
data "EnableContext" "OnActionResourcesChanged;OnEquip;OnStatusRemoved;OnStatusApplied"

new entry "Interrupt_Now_You_Dont"
type "InterruptData"
data "DisplayName" "d3e15e63749c4b62b8e7760cc707412000z12;1"
data "Description" "d3e15e63749c4b62b8e7760cc7074120000zl;3"
data "Icon" "Spell_Divination_ArcaneEye"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and Enemy(context.Source,context.Observer) and CanSee(context.Source,context.Observer) and IsMeleeAttack() and IsMiss() and not HasStatus('SG_Invisible',context.Source) and not AnyEntityIsItem() and not DistanceToEntityGreaterThan(2, context.ObserverPosition, context.Source) and HasLastAttackTriggered()"
data "Properties" "UseSpell(SWAP,Target_Now_You_Dont,true,true,true);ApplyStatus(OBSERVER_OBSERVER,INTERRUPT_RIPOSTE,100,0)"
data "Cost" "ReactionActionPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "Stack" "OnDamaged"

new entry "Interrupt_Vanishing_Bomb"
type "InterruptData"
data "DisplayName" "d3e15e63749c4b62b8e7760cc707412000z19;1"
data "Description" "d3e15e63749c4b62b8e7760cc7074120000zs;3"
data "Icon" "Spell_Illusion_Invisibility"
data "InterruptContext" "OnCastHit"
data "InterruptContextScope" "Self"
data "InterruptFlags" "InterruptWhileInvisible"
data "Container" "YesNoDecision"
data "Conditions" "IsAbleToReact(context.Observer) and Enemy(context.Source,context.Observer) and IsMiss() and not HasStatus('SG_Invisible',context.Source) and not AnyEntityIsItem() and not DistanceToEntityGreaterThan(2, context.ObserverPosition, context.Source) and HasLastAttackTriggered()"
data "Properties" "ApplyStatus(OBSERVER_OBSERVER,VANISHING_ACT,100,1)"
data "Cost" "ReactionActionPoint:1"
data "InterruptDefaultValue" "Ask;Enabled"
data "Stack" "OnDodge"
